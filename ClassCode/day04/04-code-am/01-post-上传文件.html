<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <!-- multiple 可以多选 -->
    <!-- <input type="file" name="" id="" onchange="fn()" multiple /> -->
    <input type="file" name="" id="" onchange="fn()" />
    <img src="" alt="" />
    <script>
      // 获取文件的 二进制数据，创建FormData 对象）（二进制数据添加到formData对象中），放到请求体中

      // 获取文件的 二进制数据，
      // 创建FormData 对象）
      // 二进制数据添加到formData对象中
      // FormData 对象  放到请求体中

      function fn() {
        //也有可能点击上传按钮获取
        console.log("监听iptchange事件 获取ipt的选中二进制数据");
        let ipt = document.querySelector("input");
        //files (file文件)

        //获取ipt中选中一组文件
        console.log(ipt.files);
        // ipt.files 伪数组
        //数组中放 file文件对象
        //
        let file = ipt.files[0];
        console.log(file);
        //文件名
        console.log(file.name);
        //文件的大小-单位字节 B
        // file.size/1000 -> KB
        console.log(file.size);
        // 1-获取文件的 二进制数据，
        //
        // file 文件对象，二进制数据

        //2- 创建FormData 对象
        let fd = new FormData();
        // 3-二进制数据添加到formData对象中
        // /添加要上传的参数和参数值
        //参数名--看接口文档
        // 参数值--文件对象
        fd.append("file", file);
        // 4-FormData 对象  放到请求体中
        let xhr = new XMLHttpRequest();
        let url = "http://localhost/upload_file_qn.php";
        xhr.open("POST", url);
        //自动设置请求头 content-type
        xhr.send(fd);
        xhr.onload = function () {
          if (xhr.status == 200) {
            //把服务器返回的数据转为 js对象
            let obj = JSON.parse(xhr.responseText);
            console.log(obj);
            //服务器返回的图片网址
            console.log(obj.file_url);
            document.querySelector("img").src = obj.file_url;
          }
        };
      }
    </script>
  </body>
</html>
