<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/1.7.2/axios.min.js"></script>
    <script src="./http.js"></script>
  </head>
  <body>
    <input type="text" name="" id="" />
    <input type="text" name="" id="" />
    <input type="button" name="" id="" value="登录" />
    <span></span>
    <script>
      /*
                  登录接口
                      点击登录按钮的时候，获取输入框的值（接口参数），调用登录接口
              */
      let ipts = document.querySelectorAll("input");
      ipts[2].onclick = function () {
        let username = ipts[0].value;
        let password = ipts[1].value;

        let url = "/users/login";

        http({
          url: url,
          method: "POST",
          data: {
            username,
            password,
          },
        }).then((r) => {
          let span = document.querySelector("span");
          span.innerHTML = obj.message;

          let obj = r.data;

          if (obj.code == 0) {
            span.style.color = "red";
          } else {
            //登录成功
            /*

            此服务器所有需要登录后使用的接口

      - 均在 `请求头` 内携带 `authorization` 字段, 传递 `token` 值方可

            token**** 是一个登录凭证--登录接口成功以后，后端返回的 一个 加密字符串

              有些接口需要设置 请求头的字段 --`authorization` 字段, 传递 `token` 值方可

            */

            console.log(obj);
            //1----登录成功以后存入token
            localStorage.setItem("token", obj.token);
            localStorage.setItem("uid", obj.user.id);

            span.style.color = "green";
            setTimeout(() => {
              location.href = "03-商品列表.html";
            }, 500);
          }
        });
      };
    </script>
  </body>
</html>
